(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"133f":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));a("c975"),a("c19f"),a("ace4"),a("5cc6"),a("ddb0"),a("2b3d");let s="undefined"!==typeof Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=s&&"undefined"!==typeof Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),n="undefined"!==typeof HTMLCanvasElement&&HTMLCanvasElement.prototype.toBlob,o=n||"undefined"!==typeof Uint8Array&&"undefined"!==typeof ArrayBuffer&&"undefined"!==typeof atob,r="undefined"!==typeof FileReader||"undefined"!==typeof URL;class l{static resize(e,t,a){"function"===typeof t&&(a=t,t={width:640,height:480});t.width,t.height;if(!l.isSupported()||!e.type.match(/image.*/))return a(e,!1),!1;if(e.type.match(/image\/gif/))return a(e,!1),!1;let s=document.createElement("img");return s.onload=i=>{let o=s.width,r=s.height,c=!1;if(o>=r&&o>t.width?(r*=t.width/o,o=t.width,c=!0):r>t.height&&(o*=t.height/r,r=t.height,c=!0),!c)return void a(e,!1);let d=document.createElement("canvas");d.width=o,d.height=r;let h=d.getContext("2d");if(h.drawImage(s,0,0,o,r),n)d.toBlob((e=>{a(e,!0)}),e.type);else{let t=l._toBlob(d,e.type);a(t,!0)}},l._loadImage(s,e),!0}static _toBlob(e,t){let a,n=e.toDataURL(t),o=n.split(",");a=o[0].indexOf("base64")>=0?atob(o[1]):decodeURIComponent(o[1]);let r=new ArrayBuffer(a.length),l=new Uint8Array(r);for(let s=0;s<a.length;s+=1)l[s]=a.charCodeAt(s);let c=o[0].split(":")[1].split(";")[0],d=null;if(s)d=new Blob([i?l:r],{type:c});else{let e=new BlobBuilder;e.append(r),d=e.getBlob(c)}return d}static _loadImage(e,t,a){if("undefined"===typeof URL){let s=new FileReader;s.onload=function(t){e.src=t.target.result,a&&a()},s.readAsDataURL(t)}else e.src=URL.createObjectURL(t),a&&a()}static isSupported(){return"undefined"!==typeof HTMLCanvasElement&&o&&r}}},"5b17":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{ref:"pageChat",staticClass:"page-chat bg-grey-2"},[e.otherUser.online?e._e():a("q-banner",{staticClass:"bg-grey-4 text-center flex hidden"},[e._v("\n    "+e._s(e.otherUser.name)+" no esta en línea.\n  ")]),a("div",{staticClass:"q-pa-md column col justify-end",class:{invisible:!e.showMessages}},e._l(e.limit,(function(e,t){return a("q-chat-message",{key:t,attrs:{sent:"me"==e.from,align:"me"==e.from?"right":"left"}},[a("Chat",{attrs:{message:e}})],1)})),1),a("q-footer",{staticClass:"bg-white",staticStyle:{"max-width":"350px",margin:"auto","text-align":"left"}},[a("q-toolbar",{staticClass:"text-weight-bold",staticStyle:{padding:".8em"}},[a("q-form",{staticClass:"full-width",attrs:{id:"myform"},on:{submit:function(t){return e.SendChat("text")}}},[e.load?a("div",{staticClass:"bg-white text-grey",staticStyle:{"text-align":"center"}},[a("q-spinner",{attrs:{color:"grey-6",size:"3em",thickness:2}})],1):e._e(),e.tab?a("q-tabs",{staticClass:"bg-white text-left",staticStyle:{opacity:".9"}},[a("q-tab",{staticClass:"text-blue",staticStyle:{padding:".2em"},attrs:{icon:"photo_camera"},on:{click:function(t){return e.galeria(2)}}}),a("q-tab",{staticClass:"text-orange-8",staticStyle:{padding:".2em"},attrs:{icon:"photo"},on:{click:function(t){return e.galeria(1)}}}),a("q-tab",{staticClass:"text-grey-8",staticStyle:{padding:".2em"},attrs:{icon:"attachment"},on:{click:function(t){return e.galeria(4)}}}),a("q-tab",{staticClass:"text-black",staticStyle:{padding:".2em"},attrs:{icon:"gif"},on:{click:function(t){return e.galeria(5)}}}),a("q-tab",{staticClass:"text-grey-8",staticStyle:{padding:".2em"},attrs:{icon:"close"},on:{click:function(t){e.tab=!1}}})],1):e._e(),a("q-input",{ref:"newMessage",attrs:{id:"message","bg-color":"white",color:"black",placeholder:"Escribe tu mensaje aquí....",autogrow:"",dense:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.SendChat("text")}},model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}},[a("q-btn",{staticClass:"text-black",attrs:{round:"",dense:"",flat:"",icon:"camera"},on:{click:function(t){e.tab=!0}}}),a("q-btn",{staticClass:"text-primary",attrs:{round:"",dense:"",flat:"",type:"submit",icon:"send"}})],1)],1)],1)],1),a("q-dialog",{attrs:{position:"bottom"},model:{value:e.dialog_gifs,callback:function(t){e.dialog_gifs=t},expression:"dialog_gifs"}},[a("searchGifs")],1),a("q-dialog",{model:{value:e.show_minMenu,callback:function(t){e.show_minMenu=t},expression:"show_minMenu"}},[a("minMenu")],1),a("input",{staticClass:"hidden",attrs:{filled:"",hint:"Native file",id:"subir",type:"file",accept:"image/*"},on:{change:e.changeFoto}}),a("input",{attrs:{hidden:"",type:"file",id:"subirCam",name:"file",accept:"image/*;",capture:"camera"},on:{change:e.changeFoto}}),a("input",{staticStyle:{display:"none"},attrs:{id:"subirArch",type:"file"},on:{change:e.mandarArchivo}}),1==this.$store.state.store.loads?a("div",[a("input",{attrs:{id:"change",type:"text"},on:{click:e.onUpload}}),a("img",{attrs:{id:"preview"}}),a("q-btn",{attrs:{to:"/camara",label:"camara"}}),a("q-btn",{attrs:{to:"/video",label:"video"}})],1):a("div",[a("input",{attrs:{id:"change",type:"text",hidden:""},on:{click:e.onUpload}}),a("img",{attrs:{id:"preview",hidden:""}})])],1)},i=[],n=(a("26e9"),a("fb6a"),a("ddb0"),a("2b3d"),a("ded3")),o=a.n(n),r=a("2f62"),l=(a("e6cf"),a("bd4c")),c=a("133f");let d="asd";const h={hora(){let e=l["a"].formatDate(new Date,"HH:mm DD/MM/YY");return e},leerTxt(){let e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4==e.readyState&&200==e.status&&alert(e.responseText)},e.open("GET","doc.json",!0),e.send()},scrollV(e,t){let a=Math.floor(e/t+e/500);return a},async resizeTools(e,t){return d=await c["a"].resize(e,{width:t,height:t},(async function(e,t){let a=await window.URL.createObjectURL(e);preview.src=a})),console.log(d),d}};var u=h,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-list",{staticClass:"bg-white text-center",staticStyle:{padding:"5px"}},[a("q-input",{staticStyle:{padding:"0em .8em"},attrs:{autofocus:"",type:"text",label:"Buscar gif"},on:{keyup:e.searchGif},model:{value:e.gif,callback:function(t){e.gif=t},expression:"gif"}}),a("br"),a("div",{ref:"pagechat",staticStyle:{display:"flex","flex-wrap":"wrap"}},e._l(e.urlGif,(function(t,s){return a("q-list",{key:s,staticStyle:{margin:"auto"}},[a("div",{directives:[{name:"close-popup",rawName:"v-close-popup"}],on:{click:function(a){return e.ongif(t.embed_url)}}},[a("iframe",{staticStyle:{"pointer-events":"none"},style:e.width,attrs:{src:t.embed_url,frameborder:"0"}})])])})),1)],1)},f=[],p=a("bc3a"),m=a.n(p),b={data(){return{urlGif:"",gif:"",cant_gif:10}},computed:{width(){let e=this.$q.screen.width;return{width:.47*e+"px"}}},methods:o()(o()({},Object(r["b"])("store",["SendMessage","RecibeMessage"])),{},{searchGif(){m.a.get("https://api.giphy.com/v1/gifs/search?q="+this.gif+"&api_key=dIJrma20pSU6ymMwWnDbiaT7NFHeAGVa&limit="+this.cant_gif).then((e=>{this.urlGif=e.data.data}))},ongif(e){let t=u.hora();this.SendMessage({tipo:"gif",text:e,textweb:e,hora:t}),this.RecibeMessage({tipo:"gif",text:e,textweb:e,hora:t}),this.gif=""}})},w=b,y=a("2877"),v=a("1c1c"),x=a("27f9"),C=a("9c40"),_=a("7f67"),k=a("eebe"),M=a.n(k),q=Object(y["a"])(w,g,f,!1,null,null,null),S=q.exports;M()(q,"components",{QList:v["a"],QInput:x["a"],QBtn:C["a"]}),M()(q,"directives",{ClosePopup:_["a"]});var T=a("2b33"),U={data(){return{load:!1,dialog_gifs:!1,tab:!1,newMessage:"",show_minMenu:!1,showMessages:!1,fotolocal:"",calidad:700,cant_limit:0}},components:{minMenu:a("804c").default,Chat:a("ba12").default,searchGifs:S},computed:o()(o()(o()({},Object(r["e"])("store",["userDetails","otherId"])),Object(r["c"])("store",["messages"])),{},{otherUser(){return this.$store.state.store.amigos[this.otherId]},limit(){try{let e=Object.values(this.messages[this.otherId]).reverse(),t=[];return Object.values(e).slice(0,this.cant_limit).forEach((e=>{const a=Object.assign({},e);a.text="text"===a.tipo?Object(T["decodeBase64"])(a.text):a.text,t.push(a)})),t.reverse()}catch(e){return{0:{tipo:"text",text:"Escribe tu 1er mensaje"}}}}}),destroyed(){this.StopGettingMessages()},watch:{messages:function(e){Object.keys(e).length&&this.scrollToBottom()}},mounted(){this.scrollToBottom(),setTimeout((()=>{this.showMessages=!0}),0);let e=this.$q.screen.height;this.cant_limit=e<642?10:e<851?15:20;let t=document.scrollingElement||document.body,a=t.scrollHeight;window.onscroll=()=>{let e=t.scrollHeight;0>=window.scrollY-200&&e!=a&&(window.scroll(0,e-a),this.cant_limit+=10,a=e)}},methods:o()(o()({},Object(r["b"])("store",["StopGettingMessages","SendMessage","RecibeMessage","subirArchivo"])),{},{scrollToBottom(){let e=this.$refs.pageChat.$el;setTimeout((()=>{window.scrollTo(0,e.scrollHeight)}),0)},noti(){this.$q.notify({position:"top",message:this.otherUser.name+"Te mando un mensaje",color:"green"})},SendChat(e){let t,a=u.hora(),s="";2==change.value?(1==this.$store.state.store.loads&&(alert("222"),alert(this.newMessage),alert(this.fotolocal)),t=this.fotolocal,s=this.newMessage):t=Object(T["encodeBase64"])(this.newMessage);let i={tipo:e,text:t,textweb:s,hora:a};this.SendMessage(i),this.RecibeMessage(i),this.clearMessage()},clearMessage(){change.value=1,this.newMessage=""},galeria(e){this.tab=!1,1==e?subir.click():2==e?subirCam.click():4==e?subirArch.click():5==e&&(this.dialog_gifs=!0)},resizeTools(e,t){c["a"].resize(e,{width:t,height:t},(function(e,t){preview.src=window.URL.createObjectURL(e),change.click()}))},changeFoto(e){this.resizeTools(e.target.files[0],this.calidad)},onUpload(){this.load=!0;let e=u.hora(),t="FotosSend/"+this.userDetails.email+"/"+this.otherUser.name+"/"+e;const a=a=>{var s=function(e,t){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.addEventListener("load",(function(){t(a.response)})),a.send()};s(a,(a=>{let s={file:a,ruta:t,hora:e,tipo:"foto"};2==change.value&&(s.fotolocal=1),this.subirArchivo(s).then(this.load=!1)}))};a(preview.src)},captureImage(){function e(e){preview.src=e,change.click()}function t(e){}change.value=2,navigator.camera.getPicture(e,t,{quality:100,destinationType:Camera.DestinationType.FILE_URI,targetHeight:this.calidad,targetWidth:this.calidad})},mandarArchivo(e){this.load=!0;let t=u.hora(),a=e.target.files[0].name,s="Archivos/"+this.userDetails.email+"/"+this.otherUser.name+"/"+a;this.subirArchivo({file:e.target.files[0],ruta:s,name:a,hora:t,tipo:"url"}).then(this.load=!1),this.clearMessage()}})},j=U,B=a("9989"),O=a("54e1"),R=a("8169"),L=a("7ff0"),A=a("65c6"),E=a("0378"),Q=a("0d59"),I=a("429b"),H=a("7460"),D=a("24e8"),$=Object(y["a"])(j,s,i,!1,null,null,null);t["default"]=$.exports;M()($,"components",{QPage:B["a"],QBanner:O["a"],QChatMessage:R["a"],QFooter:L["a"],QToolbar:A["a"],QForm:E["a"],QSpinner:Q["a"],QTabs:I["a"],QTab:H["a"],QInput:x["a"],QBtn:C["a"],QDialog:D["a"]})},"804c":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-img",{attrs:{src:e.fotoClick.img}})},i=[],n={props:["fotoClick"]},o=n,r=a("2877"),l=a("068f"),c=a("eebe"),d=a.n(c),h=Object(r["a"])(o,s,i,!1,null,null,null);t["default"]=h.exports;d()(h,"components",{QImg:l["a"]})},"98ea":function(e,t,a){"use strict";var s=a("a4d4"),i=a.n(s);i.a},a4d4:function(e,t,a){},ba12:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"chats"},["text"==e.message.tipo?a("span",[e._v("\n  \t\t"+e._s(e.message.text)+"\n  \t")]):"foto"==e.message.tipo?a("q-img",{staticStyle:{width:"180px",height:"180px"},attrs:{src:e.message.text},on:{click:function(t){e.foto(e.message.text),e.watch=!0}}}):"url"==e.message.tipo?a("a",{staticStyle:{"text-decoration":"none",color:"green",display:"inline-block"},attrs:{href:e.message.text}},[e._v(" Archivo ")]):"gif"==e.message.tipo?a("div",[a("iframe",{staticStyle:{width:"180px",height:"180px","pointer-events":"none"},attrs:{frameborder:"0",src:e.message.text}})]):e._e(),a("br"),e._v(" "+e._s(e.message.hora)+"\n\n    "),a("q-dialog",{model:{value:e.watch,callback:function(t){e.watch=t},expression:"watch"}},[a("fotoCanvas",{attrs:{fotoClick:e.fotoClick}})],1)],1)},i=[],n={props:["message"],data(){return{watch:!1,fotoClick:{}}},components:{fotoCanvas:a("ea3e").default},methods:{foto(e){this.fotoClick.img=e}}},o=n,r=(a("98ea"),a("2877")),l=a("068f"),c=a("24e8"),d=a("eebe"),h=a.n(d),u=Object(r["a"])(o,s,i,!1,null,null,null);t["default"]=u.exports;h()(u,"components",{QImg:l["a"],QDialog:c["a"]})},ea3e:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%","max-height":"400px"}},[a("q-img",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{src:e.fotoClick.img}})],1)},i=[],n={props:["fotoClick"]},o=n,r=a("2877"),l=a("068f"),c=a("7f67"),d=a("eebe"),h=a.n(d),u=Object(r["a"])(o,s,i,!1,null,null,null);t["default"]=u.exports;h()(u,"components",{QImg:l["a"]}),h()(u,"directives",{ClosePopup:c["a"]})}}]);